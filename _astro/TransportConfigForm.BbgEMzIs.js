import{e as ga,c as Re,l as jt,a as qt,u as ut,b as y,i as mt,d as Ft,h as q,f as Ye,E as ha,r as Ut,H as zt,g as dt,s as Me,j as ke,k as gt,m as $e,n as Yt,U as ya,o as Vt,p as ht,q as Gt,t as ce,v as Ae,w as o,x as Jt,C as Zt,y as wa,z as Xt,A as z,B as Pt,D as Ct,F as Je,I as st,G as Qt,J as Ze,K as Sa,L as Wt,M as Ta,N as Da,O as Ia,P as yt,Q as ea,R as Ea,S as xa,T as j,V as Aa,W as Ra,X as Ma,Y as Ot,Z as ka,_ as ta,$ as La,a0 as Pa,a1 as Ca,a2 as Oa,a3 as Ka,a4 as $a,a5 as Na,a6 as Ba,a7 as Ha,a8 as ja,a9 as qa,aa as ct,ab as Fa,ac as H,ad as aa,ae as ve,af as Ua,ag as za,ah as P,ai as Ya,aj as Va,ak as Ga,al as Ja,am as Za,an as Xa,ao as Qa,ap as Wa,aq as er,ar as tr,as as ar,at as rr,au as Xe,av as V,aw as wt,ax as Y,ay as w,az as L,aA as h,aB as Le,aC as K,aD as F,aE as Qe,aF as ra,aG as ft,aH as le,aI as nr}from"./render.WudDkT4W.js";const or="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(or);ga();function Ve(t){Re===null&&jt(),qt&&Re.l!==null?ir(Re).m.push(t):ut(()=>{const a=y(t);if(typeof a=="function")return a})}function sr(t,a,{bubbles:e=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:a,bubbles:e,cancelable:r})}function na(){const t=Re;return t===null&&jt(),(a,e,r)=>{const n=t.s.$$events?.[a];if(n){const s=mt(n)?n.slice():[n],l=sr(a,e,r);for(const i of s)i.call(t.x,l);return!l.defaultPrevented}return!0}}function ir(t){var a=t.l;return a.u??={a:[],b:[],m:[]}}function fe(t,a,e=!1){q&&Ye();var r=t,n=null,s=null,l=ya,i=e?ha:0,u=!1;const d=(T,c=!0)=>{u=!0,v(c,T)};var p=null;function f(){p!==null&&(p.lastChild.remove(),r.before(p),p=null);var T=l?n:s,c=l?s:n;T&&ht(T),c&&Gt(c,()=>{l?s=null:n=null})}const v=(T,c)=>{if(l===(l=T))return;let I=!1;if(q){const x=Ut(r)===zt;!!l===x&&(r=dt(),Me(r),ke(!1),I=!0)}var S=Vt(),k=r;if(S&&(p=document.createDocumentFragment(),p.append(k=gt())),l?n??=c&&$e(()=>c(k)):s??=c&&$e(()=>c(k)),S){var M=Yt,b=l?n:s,E=l?s:n;b&&M.skipped_effects.delete(b),E&&M.skipped_effects.add(E),M.add_callback(f)}else f();I&&ke(!0)};Ft(()=>{u=!1,a(d),u||v(null,null)},i),q&&(r=ce)}function Pe(t,a){return a}function lr(t,a,e){for(var r=t.items,n=[],s=a.length,l=0;l<s;l++)Ta(a[l].e,n,!0);var i=s>0&&n.length===0&&e!==null;if(i){var u=e.parentNode;Da(u),u.append(e),r.clear(),oe(t,a[0].prev,a[s-1].next)}Ia(n,()=>{for(var d=0;d<s;d++){var p=a[d];i||(r.delete(p.k),oe(t,p.prev,p.next)),Qt(p.e,!i)}})}function Ce(t,a,e,r,n,s=null){var l=t,i={flags:a,items:new Map,first:null},u=(a&ea)!==0;if(u){var d=t;l=q?Me(Ae(d)):d.appendChild(gt())}q&&Ye();var p=null,f=!1,v=new Map,T=Jt(()=>{var k=e();return mt(k)?k:k==null?[]:Xt(k)}),c,I;function S(){ur(I,c,i,v,l,n,a,r,e),s!==null&&(c.length===0?p?ht(p):p=$e(()=>s(l)):p!==null&&Gt(p,()=>{p=null}))}Ft(()=>{I??=yt,c=o(T);var k=c.length;if(f&&k===0)return;f=k===0;let M=!1;if(q){var b=Ut(l)===zt;b!==(k===0)&&(l=dt(),Me(l),ke(!1),M=!0)}if(q){for(var E=null,x,_=0;_<k;_++){if(ce.nodeType===Zt&&ce.data===wa){l=ce,M=!0,ke(!1);break}var D=c[_],O=r(D,_);x=vt(ce,i,E,null,D,O,_,n,a,e),i.items.set(O,x),E=x}k>0&&Me(dt())}if(q)k===0&&s&&(p=$e(()=>s(l)));else if(Vt()){var Z=new Set,X=Yt;for(_=0;_<k;_+=1){D=c[_],O=r(D,_);var Q=i.items.get(O)??v.get(O);Q?(a&(Ze|Je))!==0&&oa(Q,D,_,a):(x=vt(null,i,null,null,D,O,_,n,a,e,!0),v.set(O,x)),Z.add(O)}for(const[N,re]of i.items)Z.has(N)||X.skipped_effects.add(re.e);X.add_callback(S)}else S();M&&ke(!0),o(T)}),q&&(l=ce)}function ur(t,a,e,r,n,s,l,i,u){var d=(l&xa)!==0,p=(l&(Ze|Je))!==0,f=a.length,v=e.items,T=e.first,c=T,I,S=null,k,M=[],b=[],E,x,_,D;if(d)for(D=0;D<f;D+=1)E=a[D],x=i(E,D),_=v.get(x),_!==void 0&&(_.a?.measure(),(k??=new Set).add(_));for(D=0;D<f;D+=1){if(E=a[D],x=i(E,D),_=v.get(x),_===void 0){var O=r.get(x);if(O!==void 0){r.delete(x),v.set(x,O);var Z=S?S.next:c;oe(e,S,O),oe(e,O,Z),it(O,Z,n),S=O}else{var X=c?c.e.nodes_start:n;S=vt(X,e,S,S===null?e.first:S.next,E,x,D,s,l,u)}v.set(x,S),M=[],b=[],c=S.next;continue}if(p&&oa(_,E,D,l),(_.e.f&st)!==0&&(ht(_.e),d&&(_.a?.unfix(),(k??=new Set).delete(_))),_!==c){if(I!==void 0&&I.has(_)){if(M.length<b.length){var Q=b[0],N;S=Q.prev;var re=M[0],W=M[M.length-1];for(N=0;N<M.length;N+=1)it(M[N],Q,n);for(N=0;N<b.length;N+=1)I.delete(b[N]);oe(e,re.prev,W.next),oe(e,S,re),oe(e,W,Q),c=Q,S=W,D-=1,M=[],b=[]}else I.delete(_),it(_,c,n),oe(e,_.prev,_.next),oe(e,_,S===null?e.first:S.next),oe(e,S,_),S=_;continue}for(M=[],b=[];c!==null&&c.k!==x;)(c.e.f&st)===0&&(I??=new Set).add(c),b.push(c),c=c.next;if(c===null)continue;_=c}M.push(_),S=_,c=_.next}if(c!==null||I!==void 0){for(var ee=I===void 0?[]:Xt(I);c!==null;)(c.e.f&st)===0&&ee.push(c),c=c.next;var J=ee.length;if(J>0){var Se=(l&ea)!==0&&f===0?n:null;if(d){for(D=0;D<J;D+=1)ee[D].a?.measure();for(D=0;D<J;D+=1)ee[D].a?.fix()}lr(e,ee,Se)}}d&&Ea(()=>{if(k!==void 0)for(_ of k)_.a?.apply()}),t.first=e.first&&e.first.e,t.last=S&&S.e;for(var m of r.values())Qt(m.e);r.clear()}function oa(t,a,e,r){(r&Ze)!==0&&Ct(t.v,a),(r&Je)!==0?Ct(t.i,e):t.i=e}function vt(t,a,e,r,n,s,l,i,u,d,p){var f=(u&Ze)!==0,v=(u&Sa)===0,T=f?v?z(n,!1,!1):Pt(n):n,c=(u&Je)===0?l:Pt(l),I={i:c,v:T,k:s,a:null,e:null,prev:e,next:r};try{if(t===null){var S=document.createDocumentFragment();S.append(t=gt())}return I.e=$e(()=>i(t,T,c,d),q),I.e.prev=e&&e.e,I.e.next=r&&r.e,e===null?p||(a.first=I):(e.next=I,e.e.next=I.e),r!==null&&(r.prev=I,r.e.prev=I.e),I}finally{}}function it(t,a,e){for(var r=t.next?t.next.e.nodes_start:e,n=a?a.e.nodes_start:e,s=t.e.nodes_start;s!==null&&s!==r;){var l=Wt(s);n.before(s),s=l}}function oe(t,a,e){a===null?t.first=e:(a.next=e,a.e.next=e&&e.e),e!==null&&(e.prev=a,e.e.prev=a&&a.e)}function dr(t,a,e=!1,r=!1,n=!1){var s=t,l="";j(()=>{var i=yt;if(l===(l=a()??"")){q&&Ye();return}if(i.nodes_start!==null&&(Aa(i.nodes_start,i.nodes_end),i.nodes_start=i.nodes_end=null),l!==""){if(q){ce.data;for(var u=Ye(),d=u;u!==null&&(u.nodeType!==Zt||u.data!=="");)d=u,u=Wt(u);if(u===null)throw Ra(),Ma;Ot(ce,d),s=Me(u);return}var p=l+"";e?p=`<svg>${p}</svg>`:r&&(p=`<math>${p}</math>`);var f=ka(p);if((e||r)&&(f=Ae(f)),Ot(Ae(f),f.lastChild),e||r)for(;Ae(f);)s.before(Ae(f));else s.before(f)}})}const Kt=[...` 	
\r\f \v\uFEFF`];function cr(t,a,e){var r=t==null?"":""+t;if(a&&(r=r?r+" "+a:a),e){for(var n in e)if(e[n])r=r?r+" "+n:n;else if(r.length)for(var s=n.length,l=0;(l=r.indexOf(n,l))>=0;){var i=l+s;(l===0||Kt.includes(r[l-1]))&&(i===r.length||Kt.includes(r[i]))?r=(l===0?"":r.substring(0,l))+r.substring(i+1):l=i}}return r===""?null:r}function we(t,a,e,r,n,s){var l=t.__className;if(q||l!==e||l===void 0){var i=cr(e,r,s);(!q||i!==t.getAttribute("class"))&&(i==null?t.removeAttribute("class"):t.className=i),t.__className=e}else if(s&&n!==s)for(var u in s){var d=!!s[u];(n==null||d!==!!n[u])&&t.classList.toggle(u,d)}return s}function St(t,a,e=!1){if(t.multiple){if(a==null)return;if(!mt(a))return La();for(var r of t.options)r.selected=a.includes(Ke(r));return}for(r of t.options){var n=Ke(r);if(Pa(n,a)){r.selected=!0;return}}(!e||a!==void 0)&&(t.selectedIndex=-1)}function sa(t){var a=new MutationObserver(()=>{St(t,t.__value)});a.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ta(()=>{a.disconnect()})}function Oe(t,a,e=a){var r=!0;Ca(t,"change",n=>{var s=n?"[selected]":":checked",l;if(t.multiple)l=[].map.call(t.querySelectorAll(s),Ke);else{var i=t.querySelector(s)??t.querySelector("option:not([disabled])");l=i&&Ke(i)}e(l)}),Oa(()=>{var n=a();if(St(t,n,r),r&&n===void 0){var s=t.querySelector(":checked");s!==null&&(n=Ke(s),e(n))}t.__value=n,r=!1}),sa(t)}function Ke(t){return"__value"in t?t.__value:t.value}const fr=Symbol("is custom element"),vr=Symbol("is html");function Ee(t){if(q){var a=!1,e=()=>{if(!a){if(a=!0,t.hasAttribute("value")){var r=t.value;Ge(t,"value",null),t.value=r}if(t.hasAttribute("checked")){var n=t.checked;Ge(t,"checked",null),t.checked=n}}};t.__on_r=e,$a(e),Na()}}function ge(t,a){var e=ia(t);e.value===(e.value=a??void 0)||t.value===a&&(a!==0||t.nodeName!=="PROGRESS")||(t.value=a??"")}function Ge(t,a,e,r){var n=ia(t);q&&(n[a]=t.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&t.nodeName==="LINK")||n[a]!==(n[a]=e)&&(a==="loading"&&(t[Ba]=e),e==null?t.removeAttribute(a):typeof e!="string"&&pr(t).includes(a)?t[a]=e:t.setAttribute(a,e))}function ia(t){return t.__attributes??={[fr]:t.nodeName.includes("-"),[vr]:t.namespaceURI===Ka}}var $t=new Map;function pr(t){var a=t.getAttribute("is")||t.nodeName,e=$t.get(a);if(e)return e;$t.set(a,e=[]);for(var r,n=t,s=Element.prototype;s!==n;){r=ja(n);for(var l in r)r[l].set&&e.push(l);n=Ha(n)}return e}function Tt(t=!1){const a=Re,e=a.l.u;if(!e)return;let r=()=>H(a.s);if(t){let n=0,s={};const l=aa(()=>{let i=!1;const u=a.s;for(const d in u)u[d]!==s[d]&&(s[d]=u[d],i=!0);return i&&n++,n});r=()=>o(l)}e.b.length&&qa(()=>{Nt(a,r),ct(e.b)}),ut(()=>{const n=y(()=>e.m.map(Fa));return()=>{for(const s of n)typeof s=="function"&&s()}}),e.a.length&&ut(()=>{Nt(a,r),ct(e.a)})}function Nt(t,a){if(t.l.s)for(const e of t.l.s)o(e);a()}function Dt(t,a,e){if(t==null)return a(void 0),e&&e(void 0),ve;const r=y(()=>t.subscribe(a,e));return r.unsubscribe?()=>r.unsubscribe():r}const he=[];function br(t,a){return{subscribe:se(t,a).subscribe}}function se(t,a=ve){let e=null;const r=new Set;function n(i){if(Ua(t,i)&&(t=i,e)){const u=!he.length;for(const d of r)d[1](),he.push(d,t);if(u){for(let d=0;d<he.length;d+=2)he[d][0](he[d+1]);he.length=0}}}function s(i){n(i(t))}function l(i,u=ve){const d=[i,u];return r.add(d),r.size===1&&(e=a(n,s)||ve),i(t),()=>{r.delete(d),r.size===0&&e&&(e(),e=null)}}return{set:n,update:s,subscribe:l}}function It(t,a,e){const r=!Array.isArray(t),n=r?[t]:t;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=a.length<2;return br(e,(l,i)=>{let u=!1;const d=[];let p=0,f=ve;const v=()=>{if(p)return;f();const c=a(r?d[0]:d,l,i);s?l(c):f=typeof c=="function"?c:ve},T=n.map((c,I)=>Dt(c,S=>{d[I]=S,p&=~(1<<I),u&&v()},()=>{p|=1<<I}));return u=!0,v(),function(){ct(T),f(),u=!1}})}function _r(t){let a;return Dt(t,e=>a=e)(),a}let je=!1,pt=Symbol();function ne(t,a,e){const r=e[a]??={store:null,source:z(void 0),unsubscribe:ve};if(r.store!==t&&!(pt in e))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=ve;else{var n=!0;r.unsubscribe=Dt(t,s=>{n?r.source.v=s:P(r.source,s)}),n=!1}return t&&pt in e?_r(t):o(r.source)}function mr(){const t={};function a(){ta(()=>{for(var e in t)t[e].unsubscribe();za(t,pt,{enumerable:!1,value:!0})})}return[t,a]}function gr(t,a,e){return t.set(e),a}function hr(t){var a=je;try{return je=!1,[t(),je]}finally{je=a}}function G(t,a,e,r){var n=!qt||(e&Qa)!==0,s=(e&Xa)!==0,l=(e&er)!==0,i=r,u=!0,d=()=>(u&&(u=!1,i=l?y(r):r),i),p;if(s){var f=ar in t||rr in t;p=Ya(t,a)?.set??(f&&a in t?b=>t[a]=b:void 0)}var v,T=!1;s?[v,T]=hr(()=>t[a]):v=t[a],v===void 0&&r!==void 0&&(v=d(),p&&(n&&Va(),p(v)));var c;if(n?c=()=>{var b=t[a];return b===void 0?d():(u=!0,b)}:c=()=>{var b=t[a];return b!==void 0&&(i=void 0),b===void 0?i:b},n&&(e&Ga)===0)return c;if(p){var I=t.$$legacy;return(function(b,E){return arguments.length>0?((!n||!E||I||T)&&p(E?c():b),b):c()})}var S=!1,k=((e&Wa)!==0?aa:Jt)(()=>(S=!1,c()));s&&o(k);var M=yt;return(function(b,E){if(arguments.length>0){const x=E?o(k):n&&s?Ja(b):b;return P(k,x),S=!0,i!==void 0&&(i=x),b}return tr&&S||(M.f&Za)!==0?k.v:o(k)})}var yr=Y("<option> </option>"),wr=Y("<option> </option>"),Sr=Y("<option> </option>"),Tr=Y("<option disabled>No stops available</option>"),Dr=Y('<div class="space-y-4"><!> <div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="kmbRouteSelect" class="w-full text-left"> </label> <select id="kmbRouteSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono"><option>-- Select Route --</option><!></select></div> <div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="kmbDestination" class="w-full text-left"> </label> <select id="kmbDestination" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono"></select></div> <div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="kmbStop" class="w-full text-left"> </label> <select id="kmbStop" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono"></select></div> <!></div>');function Ir(t,a){Xe(a,!1);const e=z(),r=z(),n=z(),s=na();let l=G(a,"config",8),i=G(a,"kmbRoutesData",24,()=>({})),u=G(a,"kmbRouteStopData",24,()=>[]),d=G(a,"translations",24,()=>({})),p=G(a,"currentLanguage",8,"en"),f=z(""),v=z(""),T=z(""),c=!1;function I(m){const g=[];if(u()&&u().length>0){const R=new Set;u().forEach(C=>{C.stop===m&&R.add(C.route)}),g.push(...R)}return g}function S(m,g){if(!m||g===""||!i()[m]||!i()[m][g])return[];const R=i()[m][g],C=R.bound==="1"?"O":R.bound==="2"?"I":R.bound,U=R.service_type,ue=u().filter(B=>B.route===m&&B.bound===C&&B.service_type===U);return ue.length>0?(ue.sort((B,pe)=>parseInt(B.seq)-parseInt(pe.seq)),ue.map(B=>{const _e=window.cachedStopData?.find(We=>We.stop===B.stop)?.name_en||`Stop ${B.stop}`;return{value:B.stop,text:`${B.seq}. ${_e}`,title:`${_e} (Sequence: ${B.seq})`}})):[]}Ve(()=>{if(l().sta){const m=l().sta.split("-");if(m.length===4){const[g,R,C,U]=m;if(P(f,g),P(T,U),i()[g]){const ue=i()[g].findIndex(B=>B.bound==="1"&&C==="O"||B.bound==="2"&&C==="I"||B.bound===C&&B.service_type===R);ue!==-1&&P(v,ue)}}else{const g=I(l().sta);g.length>0&&(P(f,g[0]),P(T,l().sta))}}}),V(()=>H(i()),()=>{P(e,Object.keys(i()).sort((m,g)=>m.toString().localeCompare(g.toString(),void 0,{numeric:!0})))}),V(()=>(o(f),H(i()),H(p())),()=>{P(r,o(f)&&i()[o(f)]?i()[o(f)].map((m,g)=>{const R=m[`orig_${p()}`]||m.orig_en,C=m[`dest_${p()}`]||m.dest_en;return{value:g,text:`${R} → ${C}`,title:`Route ${o(f)} - ${R} → ${C}`}}):[])}),V(()=>o(f),()=>{o(f)&&(P(v,""),P(T,""))}),V(()=>(o(r),o(v)),()=>{o(r).length>0&&o(v)===""&&P(v,o(r)[0].value)}),V(()=>(o(f),o(v)),()=>{P(n,S(o(f),o(v)))}),V(()=>(o(n),o(T)),()=>{const m=o(n).some(g=>g.value===o(T));o(n).length>0&&(!o(T)||!m)?P(T,o(n)[0].value):o(n).length===0&&P(T,"")}),V(()=>(o(f),o(v),o(T),H(i()),H(l())),()=>{if(o(f)&&o(v)!==""&&o(T)){const m=i()[o(f)]?.[o(v)];if(m){const g=m.bound==="1"?"O":m.bound==="2"?"I":m.bound,R=m.service_type,C=`${o(f)}-${R}-${g}-${o(T)}`;l().sta!==C&&s("configChange",{sta:C})}}}),wt(),Tt();var k=Dr(),M=w(k);fe(M,m=>{});var b=L(M,2),E=w(b),x=w(E,!0);h(E);var _=L(E,2);j(()=>{o(f),Le(()=>{o(e)})}),_.disabled=c;var D=w(_);D.value=D.__value="";var O=L(D);Ce(O,1,()=>o(e),Pe,(m,g)=>{var R=yr(),C=w(R,!0);h(R);var U={};j(()=>{K(C,o(g)),U!==(U=o(g))&&(R.value=(R.__value=o(g))??"")}),F(m,R)}),h(_),h(b);var Z=L(b,2),X=w(Z),Q=w(X,!0);h(X);var N=L(X,2);j(()=>{o(v),Le(()=>{o(f),o(r)})}),Ce(N,5,()=>o(r),Pe,(m,g)=>{var R=wr(),C=w(R,!0);h(R);var U={};j(()=>{Ge(R,"title",(o(g),y(()=>o(g).title))),K(C,(o(g),y(()=>o(g).text))),U!==(U=(o(g),y(()=>o(g).value)))&&(R.value=(R.__value=(o(g),y(()=>o(g).value)))??"")}),F(m,R)}),h(N),h(Z);var re=L(Z,2),W=w(re),ee=w(W,!0);h(W);var J=L(W,2);j(()=>{o(T),Le(()=>{o(f),o(v),o(n)})}),Ce(J,5,()=>o(n),Pe,(m,g)=>{var R=Sr(),C=w(R,!0);h(R);var U={};j(()=>{Ge(R,"title",(o(g),y(()=>o(g).title))),K(C,(o(g),y(()=>o(g).text))),U!==(U=(o(g),y(()=>o(g).value)))&&(R.value=(R.__value=(o(g),y(()=>o(g).value)))??"")}),F(m,R)},m=>{var g=Tr();g.value=g.__value="",F(m,g)}),h(J),h(re);var Se=L(re,2);fe(Se,m=>{}),h(k),j(()=>{K(x,(H(d()),y(()=>d().labelKmbRoute||"KMB Route:"))),K(Q,(H(d()),y(()=>d().labelKmbDirection||"KMB Direction:"))),N.disabled=!o(f),K(ee,(H(d()),y(()=>d().labelKmbStop||"KMB Stop:"))),J.disabled=!o(f)||o(v)===""}),Oe(_,()=>o(f),m=>P(f,m)),Oe(N,()=>o(v),m=>P(v,m)),Oe(J,()=>o(T),m=>P(T,m)),F(t,k),Qe()}var Er=Y("<option> </option>"),xr=Y("<option> </option>"),Ar=Y('<div class="space-y-4"><div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="mtrLine" class="w-full text-left"> </label> <select id="mtrLine" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono"></select></div> <div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="mtrStation" class="w-full text-left"> </label> <select id="mtrStation" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono"></select></div></div>');function Rr(t,a){Xe(a,!1);const e=z(),r=na();let n=G(a,"config",8),s=G(a,"mtrLinesData",8),l=G(a,"translations",8),i=z(""),u=z(""),d=z([]);Ve(()=>{if(n().sta&&n().sta.includes("-")){const b=n().sta.split("-");P(i,b[0]||""),P(u,b[1]||"")}else o(e).length>0&&P(i,o(e)[0])}),V(()=>H(s()),()=>{P(e,Object.keys(s()||{}))}),V(()=>(o(e),o(i)),()=>{o(e).length>0&&!o(i)&&P(i,o(e)[0])}),V(()=>(o(i),H(s()),o(d),o(u)),()=>{if(o(i)&&s()[o(i)]){P(d,s()[o(i)].stations||[]);const b=o(d).some(E=>E.code===o(u));o(d).length>0&&(!o(u)||!b)?P(u,o(d)[0].code):o(d).length===0&&P(u,"")}else P(d,[]),P(u,"")}),V(()=>(o(i),o(u),H(n())),()=>{if(o(i)&&o(u)){const b=`${o(i)}-${o(u)}`;n().sta!==b&&r("configChange",{sta:b})}}),wt(),Tt();var p=Ar(),f=w(p),v=w(f),T=w(v,!0);h(v);var c=L(v,2);j(()=>{o(i),Le(()=>{o(e),s()})}),Ce(c,5,()=>o(e),Pe,(b,E)=>{var x=Er(),_=w(x,!0);h(x);var D={};j(()=>{K(_,(H(s()),o(E),y(()=>s()[o(E)]?.en||o(E)))),D!==(D=o(E))&&(x.value=(x.__value=o(E))??"")}),F(b,x)}),h(c),h(f);var I=L(f,2),S=w(I),k=w(S,!0);h(S);var M=L(S,2);j(()=>{o(u),Le(()=>{o(d)})}),Ce(M,5,()=>o(d),Pe,(b,E)=>{var x=xr(),_=w(x,!0);h(x);var D={};j(()=>{K(_,(o(E),y(()=>o(E).en))),D!==(D=(o(E),y(()=>o(E).code)))&&(x.value=(x.__value=(o(E),y(()=>o(E).code)))??"")}),F(b,x)}),h(M),h(I),h(p),j(()=>{K(T,(H(l()),y(()=>l().labelMtrLine||"MTR Line:"))),K(k,(H(l()),y(()=>l().labelMtrStation||"MTR Station:")))}),Oe(c,()=>o(i),b=>P(i,b)),Oe(M,()=>o(u),b=>P(u,b)),F(t,p),Qe()}var Mr=Y('<div role="alert"><div class="flex items-center justify-between"><span> </span> <button class="ml-4 text-lg leading-none" aria-label="Close notification">×</button></div></div>');function kr(t,a){Xe(a,!1);const e=z();let r=G(a,"message",8,""),n=G(a,"type",8,"info"),s=G(a,"duration",8,3e3),l=G(a,"show",12,!1),i=z();V(()=>(H(l()),H(s()),o(i)),()=>{l()&&s()>0&&(clearTimeout(o(i)),P(i,setTimeout(()=>{l(!1)},s())))}),V(()=>{},()=>{P(e,{info:"bg-blue-100 border-blue-400 text-blue-700",success:"bg-green-100 border-green-400 text-green-700",error:"bg-red-100 border-red-400 text-red-700",warning:"bg-yellow-100 border-yellow-400 text-yellow-700"})}),wt();var u=ra(),d=ft(u);{var p=f=>{var v=Mr(),T=w(v),c=w(T),I=w(c,!0);h(c);var S=L(c,2);h(T),h(v),j(()=>{we(v,1,`fixed top-4 right-4 p-3 border rounded shadow-lg z-50 transition-all duration-300 ${o(e),H(n()),y(()=>o(e)[n()])??""}`),K(I,r())}),le("click",S,()=>l(!1)),F(f,v)};fe(d,f=>{l()&&f(p)})}F(t,u),Qe()}class Lr{constructor(){this.cache=new Map}async loadTranslations(a="en"){const e=`translations-${a}`;if(this.cache.has(e))return this.cache.get(e);try{const n=await fetch(`/MMM-HK-Transport-ETA-Configurator/${a}.json`);if(n.ok){const s=await n.json();return this.cache.set(e,s),s}}catch(n){console.error(`Error loading translations for ${a}:`,n)}const r={pageTitle:"MMM-HK-Transport-ETA Configuration",pageDescription:"To configure the module, modify the settings using the form, and then copy the updated JSON back into your <code>config.json</code> file in the module directory.",labelTransportETAProvider:"Transport ETA Provider:",labelMtrLine:"MTR Line:",labelMtrStation:"MTR Station:",labelSta:"Station/Stop ID:",labelKmbRoute:"KMB Route:",labelKmbDirection:"KMB Direction:",labelKmbStop:"KMB Stop:",labelReloadInterval:"Reload Interval (minutes):",labelUpdateInterval:"Update Interval (seconds):",labelAnimationSpeed:"Animation Speed (milliseconds):",labelInitialLoadDelay:"Initial Load Delay (milliseconds):",labelJsonOutput:"Copy updated config.json content from here:",advancedSettingsText:"Advanced Settings",errorFetchingKmbRoutes:"Error fetching KMB routes"};return this.cache.set(e,r),r}async loadMtrLinesData(){const a="mtr-lines";if(this.cache.has(a))return this.cache.get(a);try{const e=await fetch("/MMM-HK-Transport-ETA-Configurator/external/mtr-lines.json");if(e.ok){const r=await e.json();return this.cache.set(a,r),r}}catch(e){console.error("Error fetching MTR lines:",e)}return{}}async loadKmbData(){const a="kmb-data";if(this.cache.has(a))return this.cache.get(a);try{window.HKTransportETAProvider||await this.initializeHKTransportETAProvider();const e=window.HKTransportETAProvider.initialize("kmb",{apiBase:"https://data.etabus.gov.hk/v1/transport/kmb"}),[r,n,s]=await Promise.all([e.fetchData(`${e.config.apiBase}/route/`),e.fetchData(`${e.config.apiBase}/stop/`),e.fetchData(`${e.config.apiBase}/route-stop/`)]);if(!r.ok||!n.ok||!s.ok)throw new Error("Failed to fetch KMB data from API");const l=await r.json(),i=await n.json(),u=await s.json(),d={};l.data.forEach(f=>{const v=f.route;d[v]||(d[v]=[]),d[v].push({route:f.route,bound:f.bound,service_type:f.service_type,orig_en:f.orig_en,dest_en:f.dest_en})}),window.cachedStopData=i.data;const p={kmbRoutesData:d,kmbRouteStopData:u.data,stopData:i.data};return this.cache.set(a,p),p}catch(e){throw console.error("Error fetching KMB data:",e),new Error(`Failed to load KMB data: ${e.message}`)}}async initializeHKTransportETAProvider(){const a=["/scripts/main.js","/scripts/providers/kmb.js"];for(const e of a)document.querySelector(`script[src="${e}"]`)||await this.loadScript(e);window.HKTransportETAProvider||(window.HKTransportETAProvider={initialize:(e,r)=>({config:{apiBase:"https://data.etabus.gov.hk/v1/transport/kmb",...r},fetchData:async n=>fetch(n)})})}loadScript(a){return new Promise((e,r)=>{const n=document.createElement("script");n.type="module",n.src=a,n.onload=e,n.onerror=r,document.head.appendChild(n)})}clearCache(){this.cache.clear()}}const qe=new Lr,bt={transportETAProvider:"mtr",sta:"HOK",reloadInterval:6e4,updateInterval:5e3,animationSpeed:2500,initialLoadDelay:0,colored:!1,showHeader:!1},Ne=se({...bt});It(Ne,t=>t.transportETAProvider);It(Ne,t=>t.sta);const Bt=se({}),_t=se({}),lt=se({}),ze=se([]),xe=se(!1),Fe=se(""),Ht=se(!1),Ue=se({show:!1,message:"",type:"info"});function ye(t){Ne.update(a=>({...a,...t}))}const Pr=It([Ne,_t,ze],([t,a,e])=>{if(!t.sta)return"";const r={};for(const n in t)if(n==="transportETAProvider")r[n]=t[n];else if(n==="sta")if(t.transportETAProvider==="mtr"&&t.sta.includes("-")){const[s,l]=t.sta.split("-"),i=a[s];if(i){const u=i.stations.find(d=>d.code===l);u?r[n]=u.en:r[n]=t[n]}else r[n]=t[n]}else if(t.transportETAProvider==="kmb"&&t.sta.includes("-")){let[s,l,i,u]=t.sta.split("-");if(!u){const d=e.find(p=>p.route===s&&p.serviceType===l&&p.direction===i);d&&d.stops&&d.stops.length>0&&(u=d.stops[0].stop)}s&&l&&i&&u?r[n]=u:r[n]=t[n]}else r[n]=t[n];else Object.prototype.hasOwnProperty.call(bt,n)&&t[n]!==bt[n]&&(r[n]=t[n]);return JSON.stringify({module:"MMM-HK-Transport-ETA",position:"top_right",config:r},null,4)});var Cr=Y('<div class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"> </div>'),Or=Y('<div class="mb-4 p-3 bg-blue-100 border border-blue-400 text-blue-700 rounded">Loading configuration data...</div>'),Kr=Y('<div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="sta" class="w-full text-left"> </label> <input type="text" id="sta" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono"/></div>'),$r=Y('<div class="space-y-4 border-t pt-4"><div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="reloadInterval" class="w-full text-left"> </label> <input type="number" id="reloadInterval" min="1"/></div> <div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="updateInterval" class="w-full text-left"> </label> <input type="number" id="updateInterval" min="1"/></div> <div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="animationSpeed" class="w-full text-left"> </label> <input type="number" id="animationSpeed" min="0"/></div> <div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="initialLoadDelay" class="w-full text-left"> </label> <input type="number" id="initialLoadDelay" min="0"/></div></div>'),Nr=Y('<div class="max-w-4xl mx-auto p-4"><h1> </h1> <p><!></p> <!> <!> <form class="space-y-4"><div class="mb-4 grid grid-cols-2 gap-4 items-center"><label for="provider" class="w-full text-left"> </label> <select id="provider" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono"><option>KMB</option><option>MTR</option></select></div> <!> <button type="button" class="advanced-settings-toggle w-full text-left py-2 focus:outline-none flex items-center justify-between"><span> </span> <i></i></button> <!></form> <hr class="my-6 border-gray-300"/> <div class="mb-4 grid grid-cols-2 gap-4 items-start"><label for="jsonOutput" class="w-full text-left"> </label> <div class="json-output-container w-full relative"><textarea id="jsonOutput" class="block w-full px-3 py-2 pr-12 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono" rows="10" readonly=""></textarea> <button class="absolute top-2 right-2 p-2 text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded" title="Copy to clipboard" aria-label="Copy configuration to clipboard"><i class="fas fa-copy"></i></button></div></div></div> <!>',1);function Hr(t,a){Xe(a,!1);const e=()=>ne(Ne,"$config",v),r=()=>ne(lt,"$kmbRoutesData",v),n=()=>ne(Pr,"$jsonOutput",v),s=()=>ne(Bt,"$translations",v),l=()=>ne(Fe,"$error",v),i=()=>ne(xe,"$loading",v),u=()=>ne(_t,"$mtrLinesData",v),d=()=>ne(ze,"$kmbRouteStopData",v),p=()=>ne(Ht,"$showAdvanced",v),f=()=>ne(Ue,"$toast",v),[v,T]=mr();let c=G(a,"initialConfig",24,()=>({}));Ve(()=>{Object.keys(c()).length>0&&ye(c())});async function I(){xe.set(!0),Fe.set("");try{const[A,$]=await Promise.all([qe.loadTranslations("en"),qe.loadMtrLinesData()]);if(Bt.set(A),_t.set($),e().transportETAProvider==="kmb"){const te=await qe.loadKmbData();lt.set(te.kmbRoutesData),ze.set(te.kmbRouteStopData)}}catch(A){Fe.set(`Failed to load initial data: ${A.message}`)}finally{xe.set(!1)}}Ve(()=>{Object.keys(c()).length>0&&ye(c()),I()});async function S(){if(ye({sta:""}),e().transportETAProvider==="kmb"&&Object.keys(r()).length===0){xe.set(!0);try{const A=await qe.loadKmbData();lt.set(A.kmbRoutesData),ze.set(A.kmbRouteStopData)}catch(A){Fe.set(`Failed to load KMB data: ${A.message}`)}finally{xe.set(!1)}}}async function k(){if(n())try{await navigator.clipboard.writeText(n()),Ue.set({show:!0,message:"Configuration copied to clipboard!",type:"success"})}catch(A){console.error("Failed to copy:",A),Ue.set({show:!0,message:"Failed to copy configuration. Please try again.",type:"error"})}}function M(A,$){return $!=={reloadInterval:6e4,updateInterval:5e3,animationSpeed:2500,initialLoadDelay:0}[A]}function b(A,$){ye({[A]:$})}Tt();var E=Nr(),x=ft(E),_=w(x),D=w(_,!0);h(_);var O=L(_,2),Z=w(O);dr(Z,()=>(s(),y(()=>s().pageDescription||"Configure your module settings below."))),h(O);var X=L(O,2);{var Q=A=>{var $=Cr(),te=w($,!0);h($),j(()=>K(te,l())),F(A,$)};fe(X,A=>{l()&&A(Q)})}var N=L(X,2);{var re=A=>{var $=Or();F(A,$)};fe(N,A=>{i()&&A(re)})}var W=L(N,2),ee=w(W),J=w(ee),Se=w(J,!0);h(J);var m=L(J,2),g=w(m);g.value=g.__value="kmb";var R=L(g);R.value=R.__value="mtr",h(m);var C;sa(m),h(ee);var U=L(ee,2);{var ue=A=>{Rr(A,{get config(){return e()},get mtrLinesData(){return u()},get translations(){return s()},$$events:{configChange:$=>ye($.detail)}})},B=A=>{var $=ra(),te=ft($);{var Te=ae=>{Ir(ae,{get config(){return e()},get kmbRoutesData(){return r()},get kmbRouteStopData(){return d()},get translations(){return s()},currentLanguage:"en",$$events:{configChange:de=>ye(de.detail)}})},at=ae=>{var de=Kr(),be=w(de),De=w(be,!0);h(be);var Ie=L(be,2);Ee(Ie),h(de),j(()=>{K(De,(s(),y(()=>s().labelSta||"Station/Stop ID:"))),ge(Ie,(e(),y(()=>e().sta)))}),le("input",Ie,me=>b("sta",me.target.value)),F(ae,de)};fe(te,ae=>{e(),y(()=>e().transportETAProvider==="kmb")?ae(Te):ae(at,!1)},!0)}F(A,$)};fe(U,A=>{e(),y(()=>e().transportETAProvider==="mtr")?A(ue):A(B,!1)})}var pe=L(U,2),_e=w(pe),We=w(_e,!0);h(_e);var la=L(_e,2);h(pe);var ua=L(pe,2);{var da=A=>{var $=$r(),te=w($),Te=w(te),at=w(Te,!0);h(Te);var ae=L(Te,2);Ee(ae);let de;h(te);var be=L(te,2),De=w(be),Ie=w(De,!0);h(De);var me=L(De,2);Ee(me);let Rt;h(be);var rt=L(be,2),nt=w(rt),va=w(nt,!0);h(nt);var Be=L(nt,2);Ee(Be);let Mt;h(rt);var kt=L(rt,2),ot=w(kt),pa=w(ot,!0);h(ot);var He=L(ot,2);Ee(He);let Lt;h(kt),h($),j((ie,ba,_a,ma)=>{K(at,(s(),y(()=>s().labelReloadInterval||"Reload Interval (minutes):"))),de=we(ae,1,"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono",null,de,ie),ge(ae,(e(),y(()=>e().reloadInterval))),K(Ie,(s(),y(()=>s().labelUpdateInterval||"Update Interval (seconds):"))),Rt=we(me,1,"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono",null,Rt,ba),ge(me,(e(),y(()=>e().updateInterval))),K(va,(s(),y(()=>s().labelAnimationSpeed||"Animation Speed (milliseconds):"))),Mt=we(Be,1,"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono",null,Mt,_a),ge(Be,(e(),y(()=>e().animationSpeed))),K(pa,(s(),y(()=>s().labelInitialLoadDelay||"Initial Load Delay (milliseconds):"))),Lt=we(He,1,"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono",null,Lt,ma),ge(He,(e(),y(()=>e().initialLoadDelay)))},[()=>({"border-green-500":!M("reloadInterval",e().reloadInterval),"border-blue-500":M("reloadInterval",e().reloadInterval)}),()=>({"border-green-500":!M("updateInterval",e().updateInterval),"border-blue-500":M("updateInterval",e().updateInterval)}),()=>({"border-green-500":!M("animationSpeed",e().animationSpeed),"border-blue-500":M("animationSpeed",e().animationSpeed)}),()=>({"border-green-500":!M("initialLoadDelay",e().initialLoadDelay),"border-blue-500":M("initialLoadDelay",e().initialLoadDelay)})]),le("input",ae,ie=>b("reloadInterval",parseInt(ie.target.value))),le("input",me,ie=>b("updateInterval",parseInt(ie.target.value))),le("input",Be,ie=>b("animationSpeed",parseInt(ie.target.value))),le("input",He,ie=>b("initialLoadDelay",parseInt(ie.target.value))),F(A,$)};fe(ua,A=>{p()&&A(da)})}h(W);var Et=L(W,4),et=w(Et),ca=w(et,!0);h(et);var xt=L(et,2),tt=w(xt);nr(tt);var At=L(tt,2);h(xt),h(Et),h(x);var fa=L(x,2);kr(fa,{get message(){return f(),y(()=>f().message)},get type(){return f(),y(()=>f().type)},duration:3e3,get show(){return f().show},set show(A){gr(Ue,y(f).show=A,y(f))},$$legacy:!0}),j(()=>{K(D,(s(),y(()=>s().pageTitle||"MMM-HK-Transport-ETA Configuration"))),K(Se,(s(),y(()=>s().labelTransportETAProvider||"Transport ETA Provider:"))),m.disabled=i(),C!==(C=(e(),y(()=>e().transportETAProvider)))&&(m.value=(m.__value=(e(),y(()=>e().transportETAProvider)))??"",St(m,(e(),y(()=>e().transportETAProvider)))),K(We,(s(),y(()=>s().advancedSettingsText||"Advanced Settings"))),we(la,1,`fas fa-chevron-${p()?"up":"down"}`),K(ca,(s(),y(()=>s().labelJsonOutput||"Copy updated config.json content:"))),ge(tt,n()),At.disabled=!n()}),le("change",m,A=>{b("transportETAProvider",A.target.value),S()}),le("click",pe,()=>Ht.update(A=>!A)),le("click",At,k),F(t,E),Qe(),T()}export{Hr as default};
